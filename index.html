<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>โปรแกรมคำนวณสินเชื่อ</title>
<style>
body { 
  font-family: "Tahoma", sans-serif; 
  background:#f5f6fa; 
  margin:0; 
  padding:20px; 
  display:flex; 
  justify-content:center; 
  align-items:flex-start; 
  min-height:100vh;
}
.container { 
  width:100%; 
  max-width:600px; 
  background:#fff; 
  padding:25px; 
  border-radius:12px; 
  box-shadow:0 4px 12px rgba(0,0,0,0.1); 
  box-sizing:border-box; 
}
.logo-center { 
  text-align:center; 
  margin-bottom:15px; 
}
.logo-center img { 
  width:80px; 
  margin-bottom:5px; 
}
.logo-center h2 { margin:5px 0; }
.logo-center h3 { margin:5px 0; color:#555; }

.input-group { margin-bottom:15px; }
.input-group label { display:block; margin-bottom:4px; font-weight:bold; }
.input-group input {
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:14px;
  text-align:right;
  box-sizing:border-box;
}
#memberId, #fullName { text-align:center; }  
input.red { color:red; font-weight:bold; }

button { 
  width:100%;
  padding:10px; 
  font-size:16px; 
  border:none; 
  border-radius:8px; 
  cursor:pointer; 
  margin-top:10px; 
}
#calcBtn { background:#007bff; color:white; }
#calcBtn:disabled { background:#ccc; cursor:not-allowed; }
#printBtn { background:#28a745; color:white; display:none; }

.result-wrapper { display:none; margin-top:20px; }
.result { 
  background:#f9f9f9; 
  padding:15px; 
  border-radius:8px; 
  border:1px solid #ddd; 
  font-size:14px; 
  line-height:1.5; 
}
.result h3 { text-align:center; margin-top:0; }
p.gray { font-size:12px; color:gray; margin:4px 0; }
p.warning { color:red; font-weight:bold; display:none; margin:4px 0; }

.status-bar { width:100%; background-color:#eee; border-radius:8px; height:18px; margin:5px 0; overflow:hidden; }
.status-fill { height:100%; border-radius:8px; transition:width 0.5s ease; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:12px; }

/* Print Mode */
.print-header { display:none; } /* ซ่อนปกติ */
@media print {
  body, .container { 
    width:210mm; max-width:210mm; 
    background:#fff; padding:10mm; margin:0; 
    font-size:16px; display:block; 
  }
  input, button, .gray, .warning, label, .logo-center { display:none !important; }
  .print-header { display:block; text-align:center; margin-bottom:15px; position:relative; z-index:10; }
  .print-header img { width:100px; margin-bottom:5px; }
  .print-header h2, .print-header h3 { margin:2px 0; font-size:18px; }
  .print-header p { margin:2px 0; font-size:14px; }

  /* ลายน้ำโลโก้ */
  body::before {
    content:"";
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:url('https://www.chainattsc.com/mediafiles/coop/logo/logo300.png') no-repeat center;
    background-size:250px;
    opacity:0.08;
    width:100%;
    height:100%;
    z-index:0;
  }

  .result-wrapper { display:block; margin-top:0; page-break-inside: avoid; }
  .result { font-size:16px; line-height:1.4; border:none; background:none; position:relative; z-index:10; }
  @page { size:A4; margin:15mm; }
}
</style>
</head>
<body>
<div class="container">

  <!-- โลโก้และหัวเรื่องตอนแสดงผลปกติ -->
  <div class="logo-center">
    <img src="https://www.chainattsc.com/mediafiles/coop/logo/logo300.png" alt="โลโก้สหกรณ์">
    <h2>สหกรณ์ออมทรัพย์ครูชัยนาท จำกัด</h2>
    <h3>โปรแกรมคำนวณสินเชื่อ (ด้วยตนเอง)</h3>
  </div>

  <!-- หัวกระดาษสำหรับตอนพิมพ์ -->
  <div class="print-header">
    <img src="https://www.chainattsc.com/mediafiles/coop/logo/logo300.png" alt="โลโก้สหกรณ์">
    <h2>สหกรณ์ออมทรัพย์ครูชัยนาท จำกัด</h2>
    <h3>โปรแกรมคำนวณสินเชื่อ (ด้วยตนเอง)</h3>
    <p>ที่อยู่ : 248 หมู่ 5 ถนนพหลโยธิน ตำบลบ้านกล้วย อำเภอเมืองชัยนาท จังหวัดชัยนาท</p>
    <p>โทรศัพท์ : 056-411412 ต่อ 15 | มือถือ : 092-993-3593 (ฝ่ายเทคโนโลยีสารสนเทศ)</p>
    <p>เว็บไซต์ : www.chainattsc.com | Line Official ID : @ctsc</p>
  </div>

  <!-- ฟอร์มกรอกข้อมูล -->
  <div class="input-group">
    <label>เลขทะเบียนสมาชิก (6 หลัก)</label>
    <input id="memberId" type="text" maxlength="6" placeholder="เช่น 009080">
  </div>

  <div class="input-group">
    <label>ชื่อ - นามสกุล</label>
    <input id="fullName" type="text" placeholder="กรอกชื่อ-นามสกุล">
  </div>

  <div class="input-group">
    <label>วงเงินกู้</label>
    <input id="loanAmount" type="text" value="0">
  </div>

  <div class="input-group">
    <label>อัตราดอกเบี้ย (ต่อปี)</label>
    <input id="interestRate" type="number" value="5">
  </div>

  <div class="input-group">
    <label>เงินต้นที่ต้องการส่งต่อเดือน</label>
    <input id="monthlyPrincipal" type="text" value="0">
  </div>

  <div class="input-group">
    <label>จำนวนงวด (สูงสุด 240)</label>
    <input id="installments" type="number" readonly>
    <p class="gray">* จำนวนงวด ส่งไม่เกิน 240 งวด (สมาชิกใหม่ 150 งวด)</p>
    <p id="warningMsg" class="warning">❌ จำนวนงวดเกิน 240 ไม่สามารถคำนวณได้</p>
  </div>

  <div class="input-group">
    <label>รายได้ต่อเดือน</label>
    <input id="income" type="text" value="0">
  </div>

  <div class="input-group">
    <label>ค่าใช้จ่ายต่อเดือน</label>
    <input id="expense" type="text" value="0">
  </div>

  <button id="calcBtn" onclick="calculateLoan()">คำนวณ</button>
  <button id="printBtn" onclick="window.print()">พิมพ์เอกสาร</button>

  <div class="result-wrapper">
    <div class="result" id="resultDiv"></div>
  </div>
</div>

<script>
function formatMemberId() {
  const input = document.getElementById("memberId");
  let v = input.value.replace(/\D/g, "");
  if (v.length > 0) v = v.padStart(6,"0");
  input.value = v;
}
document.getElementById("memberId").addEventListener("blur", formatMemberId);
document.getElementById("memberId").addEventListener("keypress", e => { if(e.key==="Enter") formatMemberId(); });

function formatNumber(value){ return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","); }
function parseNumber(value){ return parseFloat(value.replace(/,/g,'')) || 0; }

function updateMonthlyPrincipal() {
  const loan=parseNumber(document.getElementById('loanAmount').value);
  const mpInput=document.getElementById('monthlyPrincipal');
  const instInput=document.getElementById('installments');
  const warn=document.getElementById('warningMsg');
  let mp=parseNumber(mpInput.value);
  if(mp<=0) return;
  mp=Math.round(mp);
  mpInput.value=formatNumber(mp);
  const ci=Math.ceil(loan/mp);
  instInput.value=ci;
  if(ci>240){
    document.getElementById('calcBtn').disabled=true;
    warn.style.display='block';
    instInput.classList.add('red');
  } else {
    document.getElementById('calcBtn').disabled=false;
    warn.style.display='none';
    instInput.classList.remove('red');
  }
}

['loanAmount','income','expense','monthlyPrincipal'].forEach(id=>
  document.getElementById(id).addEventListener('input', e=>{
    const v=parseNumber(e.target.value);
    e.target.value=formatNumber(v);
    if(id==='loanAmount'||id==='monthlyPrincipal') updateMonthlyPrincipal();
  })
);

function calculateLoan(){
  const memberId=document.getElementById('memberId').value||"-";
  const fullName=document.getElementById('fullName').value||"-";
  const loan=parseNumber(document.getElementById('loanAmount').value);
  const rate=parseFloat(document.getElementById('interestRate').value);
  const income=parseNumber(document.getElementById('income').value);
  const expense=parseNumber(document.getElementById('expense').value);
  let mp=parseNumber(document.getElementById('monthlyPrincipal').value);
  if(mp<=0) mp=Math.round(loan/150);
  const ci=Math.ceil(loan/mp);
  if(ci>240) return;
  document.getElementById('installments').value=ci;

  let bal=loan, totInt=0, actualI=0;
  for(let i=0;i<ci;i++){
    const interest=Math.round((bal*(rate/100)*30)/365);
    const prin=Math.min(mp,bal);
    bal-=prin;
    totInt+=interest;
    actualI++;
    if(bal<=0) break;
  }

  const interest31=Math.round((loan*(rate/100)*31)/365);
  const net=income-expense-(mp+totInt/actualI);
  const pct=income>0?(net/income)*100:0;
  const minRemain=income*0.3;
  const ok=net>=minRemain;

  const result=document.getElementById('resultDiv');
  result.innerHTML=`
    <h3>สรุปผลการคำนวณ</h3>
    <p><b>เลขทะเบียนสมาชิก :</b> ${memberId}</p>
    <p><b>ชื่อ - นามสกุล :</b> ${fullName}</p>
    <hr>
    <p>วงเงินกู้ : ${loan.toLocaleString()} บาท</p>
    <p>จำนวนงวดที่ต้องส่ง : ${ci.toLocaleString()} งวด</p>
    <p>ส่งต้นต่อเดือน : ${mp.toLocaleString()} บาท</p>
    <p>ดอกเบี้ยต่อเดือน (31 วัน) : ${interest31.toLocaleString()} บาท</p>
    <p>รายได้ต่อเดือน : ${income.toLocaleString()} บาท</p>
    <p>ค่าใช้จ่ายต่อเดือน : ${expense.toLocaleString()} บาท</p>
    <p>รายได้คงเหลือ : ${net.toLocaleString()} บาท (${pct.toFixed(2)}%)</p>
    <p style="color:${ok?'green':'red'}; font-weight:bold;">
      ${ok?'เป็นไปตามเกณฑ์':'ไม่เป็นไปตามเกณฑ์ (ปรึกษาฝ่ายสินเชื่อ)'}
    </p>
    <div class="status-bar">
      <div class="status-fill" style="width:${Math.max(0,Math.min(100,pct))}%; background-color:${ok?'green':'red'};">
        ${pct.toFixed(2)}%
      </div>
    </div>
    <p>รายได้ที่ต้องเหลือขั้นต่ำ 30% : ${minRemain.toLocaleString()} บาท</p>
    <p>**หมายเหตุ : เป็นการคำนวณเบื้องต้น</p>
    <p>อาจต้องมีการทำประกันสินเชื่อหรือหักเงินฝากค้ำประกัน</p>
    <p>กรุณาติดต่อเจ้าหน้าที่สินเชื่ออีกครั้ง</p>
  `;
  document.querySelector('.result-wrapper').style.display='block';
  document.getElementById('printBtn').style.display='block';
}
</script>
</body>
</html>
